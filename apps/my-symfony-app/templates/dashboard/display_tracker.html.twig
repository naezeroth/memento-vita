{% extends 'base_1.html.twig' %}

{%  block main %}
{#    {{ dump(results) }}#}

{#    <div class="card">#}
        <h3 class="card-header" id="monthAndYear">
        </h3>
{#        <button onclick="CreateTable()">Extend</button>#}
        <table class="table">
            <thead id="mytableheader">
{#                <tr>#}
{#                    <th id="showYear">YEAR</th>#}
{#                    <th id="showMonth">MONTH</th>#}
{#                    <th colspan="31">JAN FEB MAR APR MAY JUN JUL AUG SEP OCT NOV DEC</th>#}
{#                </tr>#}
            </thead>
            <tbody id="mytablecontent">
{#            {% set r = results|batch(3) %}#}
{#            {% dump(results) %}#}
            {% dump(results|json_encode()) %}
            {% for r in results %}
{#                {% array_push(recurrenceArray, r.getRecurrenceCollection()) %}#}
{#                {% dump(r) %}#}
{#                {% dump(r|json_encode()) %}#}
{#                {% dump(r.getRecurrenceCollection()) %}#}
{#                {% dump(r.getName()) %}#}
{#                {% dump(r.getDone()) %}#}
            {% endfor %}
            {% dump(recurrenceResult) %}
{#            {% dump(r) %}#}
{#                {% for atom in r %}#}
{#                    {% dump(atom) %}#}
{#                    {% for entry in atom %}#}
{#                        {%  dump(entry) %}#}
{#                        <tr>#}
{#                            <td>{{ entry.name }}</td>#}
{#                        </tr>#}
{#                    {% endfor %}#}
{#                {% endfor %}#}
            </tbody>
        </table>
{#    </div>#}

    <div class="form-inline">
        <button class="btn btn-outline-primary col-sm-6" id="previous" onclick="previous()">Previous</button>
        <button class="btn btn-outline-primary col-sm-6" id="next" onclick="next()">Next</button>
    </div>
    <br/>

    <form class="form-inline">
        <label class="lead mr-2 ml-2" for="month">Jump To: </label>
        <select class="form-control col-sm-4" name="month" id="month" onchange="jump()">
            <option value=0>Jan</option>
            <option value=1>Feb</option>
            <option value=2>Mar</option>
            <option value=3>Apr</option>
            <option value=4>May</option>
            <option value=5>Jun</option>
            <option value=6>Jul</option>
            <option value=7>Aug</option>
            <option value=8>Sep</option>
            <option value=9>Oct</option>
            <option value=10>Nov</option>
            <option value=11>Dec</option>
        </select>

        <label for="year"></label>
        <select class="form-control col-sm-4" name="year" id="year" onchange="jump()">
            <option value=2020>2020</option>
            <option value=2021>2021</option>
            <option value=2022>2022</option>
            <option value=2023>2023</option>
            <option value=2024>2024</option>
            <option value=2025>2025</option>
            <option value=2026>2026</option>
            <option value=2027>2027</option>
            <option value=2028>2028</option>
            <option value=2029>2029</option>
            <option value=2030>2030</option>
        </select>
    </form>

    {% set r = results|batch(3) %}
    {% for atom in r %}
        <div class="card-deck">
            {% for entry in atom %}
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">{{ entry.name }}</h5>
                        <p class="card-text"> {{  entry.description }} </p>
                        <p class="card-text"> For goal: {{  entry.goal.name }} </p>
                        {{ dump(entry.count) }}
                        {% for i in range(0,entry.count-1) %}
                            <p class="card-text"> For date: {{ entry.getRecurrenceCollection[i] |date('Y-m-d')}}
                            {% if entry.done[i] == 1 %}
                                is done ✅
                            {% else %}
                                is not done ❌
                            {% endif %}
                            </p>
                        {% endfor %}
                        <a href="{{ path('edit_habit', {'id': entry.getId}) }}"><button class="btn btn-primary" >Edit Habit</button></a>
                    </div>
                    <div class="card-footer">
                        <small class="text-muted">Last updated 3 mins ago</small>
                    </div>
                </div>
            {% endfor %}
        </div>
        <br>
    {% endfor %}
{#    <a href="{{ path('add_habit') }}"><button class="btn btn-success" >Add Habit</button></a>#}

{%  endblock %}

{% block javascripts %}
    <script>
        today = new Date();
        currentMonth = today.getMonth();
        currentYear = today.getFullYear();
        selectYear = $('#year'); //document.getElementById("year");
        selectMonth = $('#month'); //document.getElementById("month");

        months = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];

        monthAndYear = $('#monthAndYear'); //document.getElementById("monthAndYear");

        // showCalendar(currentMonth, currentYear);

        function CreateTable() {
            var employee = new Array();
            employee.push([4, ".", "."]);
            employee.push([5, ".", "."]);
            employee.push([6, ".", "."]);
            employee.push([7, ".", "."]);
            employee.push([8, ".", "."]);

            var tableheader ="";
            tableheader +="<tr>";
            tableheader += "<th>" + "Habit" + "</th>";
            for(var i = 1; i < 32; i++){
                tableheader += "<th>" + i.toString() + "</th>";
            }
            var tablecontents = "";
            for (var i = 0; i < employee.length; i++) {
                tablecontents += "<tr>";
                for (var j = 0; j < employee[i].length; j++) {
                    tablecontents += "<td>" + employee[i][j] + "</td>";
                }
                tablecontents += "</tr>";
            }
            // document.getElementById("id_tabela").innerHTML = tablecontents;
            $("#mytableheader").append(tableheader);
            // document.getElementById("mytablecontent").innerHTML += tablecontents;
        }
        $(() => {
            {#var data = $('.js-user-rating').data('entryResults');#}
            {#console.log(data);#}
            {#var data2 = {{ results | json_encode() }}#}
            {#console.log(data2);#}
            {#for(x in data2 ){#}
            {#    console.log(x);#}
            {#}#}

            var habits = {{ results|json_encode|raw }};
            var recurrences = {{ recurrenceResult|json_encode|raw }}
                console.log(habits);
            console.log(habits[0].name);
            console.log(recurrences[0][0].date);
            var date = new Date(recurrences[0][0].date);
            console.log(date);
            showCalendar(currentMonth, currentYear);
        });

        function next() {
            currentYear = (currentMonth === 11) ? currentYear + 1 : currentYear;
            currentMonth = (currentMonth + 1) % 12;
            showCalendar(currentMonth, currentYear);
        }

        function previous() {
            currentYear = (currentMonth === 0) ? currentYear - 1 : currentYear;
            currentMonth = (currentMonth === 0) ? 11 : currentMonth - 1;
            showCalendar(currentMonth, currentYear);
        }

        function jump() {
            currentYear = parseInt(selectYear.value);
            currentMonth = parseInt(selectMonth.value);
            showCalendar(currentMonth, currentYear);
        }
        function showCalendar(month, year) {
            let numOfDays = daysInMonth(month, year);

            tbl = $('#mytableheader'); //  document.getElementById("calendar-body"); // body of the calendar]

            var prevDates = document.getElementById("mytableheader");   // Get the element with id="mytableheader"
            prevDates.removeChild(prevDates.childNodes[0]);

            $('#monthAndYear').text(months[month] + " " + year);

            selectYear.value = year;
            selectMonth.value = month;

            // creating all cells
            let date = 1;
            // for (let i = 0; i < numOfDays; i++) {
                // creates a table row
            let row = document.createElement("tr");

            cell = document.createElement("th");
            cellText = document.createTextNode("Habit");
            cell.appendChild(cellText);
            row.appendChild(cell);
            // console.log(numOfDays);
            //creating individual cells, filing them up with data.
            for (let j = 0; j < numOfDays; j++) {
                cell = document.createElement("th");
                cellText = document.createTextNode(date);
                if (date === today.getDate() && year === today.getFullYear() && month === today.getMonth()) {
                    cell.classList.add("bg-info");
                } // color today's date
                cell.appendChild(cellText);
                row.appendChild(cell);
                date++;
            }
            console.log(row);
            tbl.append(row); // appending each row into calendar body.
        }

        // check how many days in a month code from https://dzone.com/articles/determining-number-days-month
        function daysInMonth(iMonth, iYear) {
            return 32 - new Date(iYear, iMonth, 32).getDate();
        }

    </script>
{% endblock %}
